<!doctype html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Floating UI Tutorial</title>
    <style>
        #tooltip {
            display: none;
            width: max-content;
            position: absolute;
            top: 0;
            left: 0;
            background: #222;
            color: white;
            font-weight: bold;
            padding: 5px;
            border-radius: 4px;
            font-size: 90%;
        }

        #arrow {
            position: absolute;
            background: #222;
            width: 8px;
            height: 8px;
            transform: rotate(45deg);
        }
    </style>
</head>
<body>

<!--p{往下拖看提示是否会自动更新位置$}*20-->

<p>往下拖看提示是否会自动更新位置1</p>
<p>往下拖看提示是否会自动更新位置2</p>
<p>往下拖看提示是否会自动更新位置3</p>
<p>往下拖看提示是否会自动更新位置4</p>
<p>往下拖看提示是否会自动更新位置5</p>
<p>往下拖看提示是否会自动更新位置6</p>
<p>往下拖看提示是否会自动更新位置7</p>
<p>往下拖看提示是否会自动更新位置8</p>
<p>往下拖看提示是否会自动更新位置9</p>
<p>往下拖看提示是否会自动更新位置10</p>
<p>往下拖看提示是否会自动更新位置11</p>
<p>往下拖看提示是否会自动更新位置12</p>
<p>往下拖看提示是否会自动更新位置13</p>
<p>往下拖看提示是否会自动更新位置14</p>
<p>往下拖看提示是否会自动更新位置15</p>
<p>往下拖看提示是否会自动更新位置16</p>
<p>往下拖看提示是否会自动更新位置17</p>
<p>往下拖看提示是否会自动更新位置18</p>
<p>往下拖看提示是否会自动更新位置19</p>
<p>往下拖看提示是否会自动更新位置20</p>

<button id="button" aria-describedby="tooltip">
    点我弹出提示
</button>
<div id="tooltip" role="tooltip">长文本的提示内容
    <div id="arrow"></div>
</div>

<p>往下拖看提示是否会自动更新位置1</p>
<p>往下拖看提示是否会自动更新位置2</p>
<p>往下拖看提示是否会自动更新位置3</p>
<p>往下拖看提示是否会自动更新位置4</p>
<p>往下拖看提示是否会自动更新位置5</p>
<p>往下拖看提示是否会自动更新位置6</p>
<p>往下拖看提示是否会自动更新位置7</p>
<p>往下拖看提示是否会自动更新位置8</p>
<p>往下拖看提示是否会自动更新位置9</p>
<p>往下拖看提示是否会自动更新位置10</p>
<p>往下拖看提示是否会自动更新位置11</p>
<p>往下拖看提示是否会自动更新位置12</p>
<p>往下拖看提示是否会自动更新位置13</p>
<p>往下拖看提示是否会自动更新位置14</p>
<p>往下拖看提示是否会自动更新位置15</p>
<p>往下拖看提示是否会自动更新位置16</p>
<p>往下拖看提示是否会自动更新位置17</p>
<p>往下拖看提示是否会自动更新位置18</p>
<p>往下拖看提示是否会自动更新位置19</p>
<p>往下拖看提示是否会自动更新位置20</p>

<script src="quickevent.js"></script>
<script type="module">

    import {
        computePosition,
        flip,
        shift,
        offset,
        arrow,
        autoUpdate
    } from 'https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.5.3/+esm';

    const button = document.querySelector('#button');
    const tooltip = document.querySelector('#tooltip');
    const arrowElement = document.querySelector('#arrow');


    function update() {
        computePosition(button, tooltip, {
            placement: 'top',

            middleware: [
                offset(6),//offset(6)必须放在数组最前面，官方文档提示
                flip(),
                shift({padding: 10}),
                arrow({element: arrowElement})
            ],
        }).then(({x, y, placement, middlewareData}) => {
            Object.assign(tooltip.style, {
                left: `${x}px`,
                top: `${y}px`,
            });

            //访问数据
            const {x: arrowX, y: arrowY} = middlewareData.arrow;

            const staticSide = {
                top: 'bottom',
                right: 'left',
                bottom: 'top',
                left: 'right',
            }[placement.split('-')[0]];

            Object.assign(arrowElement.style, {
                left: arrowX != null ? `${arrowX}px` : '',
                top: arrowY != null ? `${arrowY}px` : '',
                right: '',
                bottom: '',
                [staticSide]: '-4px',
            });

        });
    }

    function showTooltip() {
        tooltip.style.display = 'block';
        update();
    }

    function hideTooltip() {
        tooltip.style.display = '';
    }


    // 改函数在dom从窗口删除时调用
    const cleanup = autoUpdate(
        button,
        tooltip,
        update
    );


    //触发事件
    quickevent(document).on('click', function (event) {
        const target = event.target;
        if (target.closest('#button')) {//是点击触发按钮
            // 你的触发事件代码
            if (getComputedStyle(tooltip).display === 'none') {
                showTooltip();
            } else {
                hideTooltip();
            }
        }

    });


</script>

</body>
</html>

<!doctype html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>dropdown+floating-ui</title>
    <link rel="stylesheet" href="../dist/css/quicktab.css">
    <style>
        #arrow {
            position: absolute;
            background: #222;
            width: 8px;
            height: 8px;
            transform: rotate(45deg);
        }

        #tooltip {
            display: none;
        }
    </style>
</head>
<body>

<button id="button" aria-describedby="tooltip">
    My button
</button>


<ul class="quicktab-dropdown-menu" id="tooltip">
    <li>
        <span>刷新长文本测试刷新长文本测试</span>
    </li>
    <li>
        <span>关闭其它</span>
    </li>
    <li>
        <span>关闭所有</span>
    </li>
</ul>


<script src="quickevent.min.js"></script>
<script type="module">

    import {
        computePosition,
        flip,
        shift,
        offset,
        arrow
    } from 'https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.5.3/+esm';

    const button = document.querySelector('#button');
    const tooltip = document.querySelector('#tooltip');
    const arrowElement = document.querySelector('#arrow');


    function update() {
        computePosition(button, tooltip, {
            placement: 'top',

            middleware: [
                offset(6),//offset(6)必须放在数组最前面，官方文档提示
                flip(),
                shift({padding: 10}),
                // arrow({element: arrowElement})
            ],
        }).then(({x, y, placement, middlewareData}) => {
            Object.assign(tooltip.style, {
                left: `${x}px`,
                top: `${y}px`,
            });

            //访问数据
            // const {x: arrowX, y: arrowY} = middlewareData.arrow;

            // const staticSide = {
            //     top: 'bottom',
            //     right: 'left',
            //     bottom: 'top',
            //     left: 'right',
            // }[placement.split('-')[0]];

            // Object.assign(arrowElement.style, {
            //     left: arrowX != null ? `${arrowX}px` : '',
            //     top: arrowY != null ? `${arrowY}px` : '',
            //     right: '',
            //     bottom: '',
            //     [staticSide]: '-4px',
            // });

        });
    }

    function showTooltip() {
        tooltip.style.display = 'block';
        update();
    }

    function hideTooltip() {
        tooltip.style.display = '';
    }


    function tooltipIsShow() {
        return window.getComputedStyle(tooltip).display === 'none'
    }


    //触发事件
    quickevent(document).on('click', function (event) {

        const target = event.target;
        if (target.closest('#button')) {//是点击触发按钮
            // 你的触发事件代码
            if (tooltipIsShow()) {
                showTooltip();
            } else {
                hideTooltip();
            }
        } else if (target.closest('#tooltip')) {
            hideTooltip();
        } else {

            if (!tooltipIsShow()) {
                hideTooltip();
            }
        }

    });


</script>

</body>
</html>
